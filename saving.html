<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Savings Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://aistudio.google.com/js/client"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        text-align: center;
        background: #fff5f7; /* Soft pink background */
        padding: 20px;
      }
      .container {
        width: 95%;
        max-width: 800px;
        margin: auto;
        background: white;
        padding: 15px;
        border-radius: 20px;
        box-shadow: 0px 5px 20px rgba(0, 0, 0, 0.08);
      }
      .savings-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 15px;
        position: relative;
      }
      .savings-header h2 {
        color: #ff4d8d;
        font-size: 28px;
        font-weight: 700;
        margin: 0;
        padding: 10px 0;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        display: inline-block;
      }
      .savings-header h2::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        height: 3px;
        background: linear-gradient(to right, #ffd1dc, #ff4d8d, #ffd1dc);
        border-radius: 2px;
      }
      .input-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin: 15px 0;
      }
      .input-container select,
      .input-container input,
      .input-container button {
        min-width: 140px;
        padding: 10px 15px;
        border: 2px solid #ffd1dc;
        border-radius: 25px;
        outline: none;
        transition: all 0.3s ease;
      }
      .input-container input:focus,
      .input-container select:focus {
        border-color: #ff4d8d;
        box-shadow: 0 0 0 3px rgba(255, 77, 141, 0.1);
      }
      .input-container select option {
        padding: 10px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        gap: 8px;
        padding: 10px;
        margin: 20px auto;
      }
      .grid-cell {
        background-color: white;
        border: 2px solid #ffd1dc;
        border-radius: 12px;
        padding: 10px 5px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        min-height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
      }
      .grid-cell:hover {
        background-color: #fff5f7;
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(255, 77, 141, 0.1);
      }
      .grid-cell.saved {
        background-color: #ff4d8d;
        color: white;
        border-color: #ff4d8d;
      }
      .message {
        color: #ff4d8d;
        font-size: 16px;
        font-weight: 600;
        padding: 15px;
        margin: 15px 0;
        background: rgba(255, 209, 220, 0.2);
        border-radius: 15px;
        line-height: 1.5;
      }
      button {
        cursor: pointer;
        background-color: #ff4d8d;
        color: white;
        border: none;
        border-radius: 25px;
        padding: 12px 25px;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(255, 77, 141, 0.2);
      }
      button:hover {
        background-color: #ff3377;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 77, 141, 0.3);
      }
      .progress-section {
        margin: 25px auto;
        max-width: 600px;
        padding: 15px;
        background: rgba(255, 209, 220, 0.1);
        border-radius: 15px;
      }
      .progress-bar-container {
        width: 90%;
        max-width: 500px;
        height: 12px;
        background-color: white;
        border-radius: 10px;
        margin: 15px auto;
        overflow: hidden;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(to right, #ff4d8d, #ff3377);
        transition: width 0.5s ease;
        width: 0%;
      }
      .progress-text {
        color: #ff4d8d;
        font-size: 14px;
        font-weight: 600;
        text-align: center;
        margin: 10px 0;
      }
      @media print {
        body {
          background: white !important;
        }
        .container {
          box-shadow: none;
        }
        button,
        input,
        select {
          display: none;
        }
      }
      .share-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        margin-top: 20px;
      }
      .share-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 20px;
        color: white;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.3s ease;
      }
      .whatsapp {
        background-color: #25d366;
      }
      .facebook {
        background-color: #4267b2;
      }
      .pinterest {
        background-color: #e60023;
      }
      .copy {
        background-color: #ff4d8d;
      }
      /* Mobile styles (up to 480px) */
      @media screen and (max-width: 480px) {
        .grid {
          grid-template-columns: repeat(4, 1fr);
          gap: 6px;
        }
        .grid-cell {
          padding: 8px 4px;
          min-height: 35px;
          font-size: 13px;
        }
        .input-container select,
        .input-container input,
        .input-container button {
          font-size: 13px;
          padding: 8px 12px;
        }
      }
      /* Tablet styles (481px to 768px) */
      @media screen and (min-width: 481px) and (max-width: 768px) {
        .grid {
          grid-template-columns: repeat(5, 1fr);
          gap: 8px;
        }
        .grid-cell {
          min-height: 38px;
          font-size: 13px;
          padding: 6px;
        }
      }
      /* Desktop styles (769px and above) */
      @media screen and (min-width: 769px) {
        .grid {
          grid-template-columns: repeat(6, 1fr);
          gap: 10px;
        }
        .grid-cell {
          min-height: 42px;
          font-size: 14px;
          padding: 8px;
        }
      }
      .button-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin: 20px 0;
      }
      .button-container button {
        background-color: #ff4d8d;
        color: white;
        border: none;
        border-radius: 25px;
        padding: 10px 20px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .button-container button:hover {
        background-color: #ff3377;
        transform: translateY(-2px);
      }
      .chat-container {
        max-width: 600px;
        margin: 20px auto;
        padding: 15px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(255, 77, 141, 0.1);
      }
      .chat-message {
        margin: 10px 0;
        padding: 12px 15px;
        border-radius: 15px;
        max-width: 80%;
      }
      .ai-message {
        background: #ffd1dc;
        margin-right: auto;
        color: #ff4d8d;
      }
      .user-message {
        background: #ff4d8d;
        color: white;
        margin-left: auto;
      }
      .typing-indicator {
        display: none;
        padding: 12px 15px;
        background: #ffd1dc;
        border-radius: 15px;
        margin: 10px 0;
        width: fit-content;
        color: #ff4d8d;
      }
      .typing-indicator span {
        animation: blink 1s infinite;
        margin-right: 3px;
      }
      @keyframes blink {
        50% {
          opacity: 0;
        }
      }
      .voice-btn {
        min-width: 40px !important;
        width: 40px;
        height: 40px;
        border-radius: 50% !important;
        padding: 0 !important;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #ff4d8d;
        transition: all 0.3s ease;
      }
      .voice-btn.listening {
        background-color: #ff3377;
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(255, 77, 141, 0.4);
        }
        70% {
          transform: scale(1.1);
          box-shadow: 0 0 0 10px rgba(255, 77, 141, 0);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(255, 77, 141, 0);
        }
      }
      .clear-chat-btn {
        background-color: #ff4d8d;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 8px 15px;
        font-size: 14px;
        cursor: pointer;
        margin-top: 15px;
        transition: all 0.3s ease;
        opacity: 0.8;
        display: flex;
        align-items: center;
        gap: 5px;
        margin-left: auto;
      }
      .clear-chat-btn:hover {
        opacity: 1;
        transform: translateY(-2px);
      }
      .clear-chat-btn i {
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="savings-tracker-container">
      <div class="container">
        <div class="savings-header">
          <h2>Savings Tracker</h2>
        </div>
        <div class="chat-container" id="chatContainer">
          <button onclick="clearChat()" class="clear-chat-btn">
            <i class="fas fa-trash"></i> Clear Chat
          </button>
          <div id="chatMessages">
            <div class="chat-message ai-message">
              Hi! I'm SynAI 👋 I'm here to help you save money and achieve your
              financial goals! What would you like to save for?
            </div>
          </div>
          <div class="typing-indicator" id="typingIndicator">
            <span>•</span><span>•</span><span>•</span>
          </div>
        </div>
        <div class="input-container">
          <input
            type="text"
            id="savingGoal"
            placeholder="Tell me your saving goal..."
            onkeypress="handleKeyPress(event)"
          />
          <button
            id="voiceInputBtn"
            onclick="toggleVoiceInput()"
            class="voice-btn"
          >
            <i class="fas fa-microphone"></i>
          </button>
        </div>
        <div id="message" class="message" style="display: none"></div>
        <div class="progress-section">
          <div class="progress-text" id="progressText">
            Your savings progress
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
        </div>
        <div class="grid" id="grid"></div>
        <div class="button-container">
          <button onclick="downloadPDF()">Download PDF</button>
        </div>
        <div class="share-container">
          <button onclick="copyShareLink()" class="share-btn copy">
            Copy Link
          </button>
        </div>
      </div>
    </div>
    <script>
      let recognition = null;
      let isListening = false;

      function initSpeechRecognition() {
        if ("webkitSpeechRecognition" in window) {
          recognition = new webkitSpeechRecognition();
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = "en-US";

          recognition.onstart = function () {
            isListening = true;
            document.getElementById("voiceInputBtn").classList.add("listening");
            showAIMessage("I'm listening... Speak your saving goal!");
          };

          recognition.onresult = function (event) {
            const voiceInput = event.results[0][0].transcript;
            document.getElementById("savingGoal").value = voiceInput;
            handleVoiceInput(voiceInput);
          };

          recognition.onerror = function (event) {
            console.error("Speech recognition error:", event.error);
            showAIMessage(
              "Sorry, I couldn't hear you. Please try again or type your goal."
            );
            stopVoiceInput();
          };

          recognition.onend = function () {
            stopVoiceInput();
          };
        } else {
          document.getElementById("voiceInputBtn").style.display = "none";
          console.warn("Speech recognition not supported");
        }
      }

      function toggleVoiceInput() {
        if (!recognition) {
          initSpeechRecognition();
        }

        if (isListening) {
          stopVoiceInput();
        } else {
          startVoiceInput();
        }
      }

      function startVoiceInput() {
        if (recognition) {
          recognition.start();
        }
      }

      function stopVoiceInput() {
        if (recognition) {
          recognition.stop();
          isListening = false;
          document
            .getElementById("voiceInputBtn")
            .classList.remove("listening");
        }
      }

      function handleVoiceInput(voiceInput) {
        if (voiceInput.trim()) {
          showUserMessage(voiceInput);
          handleKeyPress({ key: "Enter" });
        }
      }

      function checkSavingsFeasibility(totalAmount, days, maxDailyAmount) {
        const requiredDailyAmount = Math.ceil(totalAmount / days);
        return {
          feasible: maxDailyAmount
            ? requiredDailyAmount <= maxDailyAmount
            : true,
          requiredDailyAmount: requiredDailyAmount,
        };
      }

      async function handleKeyPress(event) {
        if (event.key === "Enter") {
          const savingGoal = document.getElementById("savingGoal").value;
          if (!savingGoal) {
            showAIMessage(
              "Please tell me what you'd like to save for. It can be anything - a vacation, new gadget, or emergency fund!"
            );
            return;
          }

          // Show user message
          showUserMessage(savingGoal);

          // Show typing indicator
          document.getElementById("typingIndicator").style.display = "block";

          try {
            // Extract numbers from the saving goal using regex
            const amountMatch = savingGoal.match(
              /(?:save|goal|total)?\s*\$?\s*(\d+(?:,\d{3})*(?:\.\d{2})?)/i
            );
            const daysMatch = savingGoal.match(/(\d+)\s*days?/i);
            const maxDailyMatch = savingGoal.match(
              /max(?:imum)?\s*(?:\$\s*?|\s+)?(\d+)(?:\s*dollars?)?\s*(?:per\s*day|daily|a\s*day)/i
            );

            if (amountMatch && daysMatch) {
              const totalAmount = parseFloat(amountMatch[1].replace(/,/g, ""));
              const days = parseInt(daysMatch[1]);
              const maxDailyAmount = maxDailyMatch
                ? parseFloat(maxDailyMatch[1].replace(/,/g, ""))
                : null;

              const feasibility = checkSavingsFeasibility(
                totalAmount,
                days,
                maxDailyAmount
              );

              if (!maxDailyAmount || feasibility.feasible) {
                showAIMessage(
                  `Great! Your goal to save $${totalAmount.toLocaleString()} in ${days} days${
                    maxDailyAmount
                      ? ` with a maximum daily saving of $${maxDailyAmount}`
                      : ""
                  } is achievable! You'll need to save $${
                    feasibility.requiredDailyAmount
                  } per day to reach your goal. Let's make it happen! 💪`
                );

                document.getElementById("message").style.display = "block";
                document.getElementById("message").textContent = `Save $${
                  feasibility.requiredDailyAmount
                } per day for ${days} days to reach $${totalAmount.toLocaleString()}`;

                generateAIGrid(totalAmount, days);
              } else {
                const suggestedDays = Math.ceil(totalAmount / maxDailyAmount);
                showAIMessage(
                  `I notice that saving $${totalAmount.toLocaleString()} in ${days} days with a maximum daily saving of $${maxDailyAmount} isn't feasible. You would need to save $${
                    feasibility.requiredDailyAmount
                  } per day, which exceeds your maximum.\n\nHere are some options:\n` +
                    `1. Extend your saving period to ${suggestedDays} days to stay within your daily limit\n` +
                    `2. Increase your maximum daily saving amount to $${feasibility.requiredDailyAmount}\n` +
                    `3. Reduce your total saving goal to $${(
                      maxDailyAmount * days
                    ).toLocaleString()} or less\n\n` +
                    `Would you like to try again with adjusted numbers? 🤔`
                );
                return;
              }
            } else {
              // Continue with the existing AI response logic for other cases
              const response = await fetch(
                "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyDh4MLDc66T0YN1Gzv2qKjSlLQ1vYR_HzU",
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    contents: [
                      {
                        parts: [
                          {
                            text: `Generate a savings plan for the goal: ${savingGoal}. 
                            Return the response in JSON format with these fields:
                            - totalAmount (number)
                            - numberOfDays (number between 30-100)
                            - dailyAmount (number)
                            - encouragingMessage (string)
                            Example: {
                              "totalAmount": 1000, 
                              "numberOfDays": 50, 
                              "dailyAmount": 20,
                              "encouragingMessage": "That's a great goal! I'll help you save $1000 in 50 days."
                            }`,
                          },
                        ],
                      },
                    ],
                  }),
                }
              );

              // Hide typing indicator
              document.getElementById("typingIndicator").style.display = "none";

              if (!response.ok) {
                throw new Error("Failed to get response from AI");
              }

              const data = await response.json();
              if (
                !data.candidates ||
                !data.candidates[0] ||
                !data.candidates[0].content ||
                !data.candidates[0].content.parts[0].text
              ) {
                throw new Error("Invalid response format from AI");
              }

              const aiText = data.candidates[0].content.parts[0].text;
              const jsonMatch = aiText.match(/\{.*\}/s);
              if (!jsonMatch) {
                throw new Error("Could not find JSON in AI response");
              }

              const planData = JSON.parse(jsonMatch[0]);

              // Show AI response message
              showAIMessage(
                planData.encouragingMessage ||
                  `Great! I'll help you save $${planData.totalAmount.toLocaleString()} over ${
                    planData.numberOfDays
                  } days. You'll need to save $${
                    planData.dailyAmount
                  } per day to reach your goal! 💪`
              );

              document.getElementById("message").style.display = "block";
              document.getElementById("message").textContent = `Save $${
                planData.dailyAmount
              } per day for ${
                planData.numberOfDays
              } days to reach $${planData.totalAmount.toLocaleString()}`;

              generateAIGrid(planData.totalAmount, planData.numberOfDays);
            }
          } catch (error) {
            console.error("Error:", error);
            document.getElementById("typingIndicator").style.display = "none";

            // Extract amount from the saving goal
            const amount = savingGoal.match(/\$?\d+/);
            if (amount) {
              const goalAmount = parseInt(amount[0].replace("$", ""));
              const daysMatch = savingGoal.match(/(\d+)\s*days?/i);
              const suggestedDays = daysMatch ? parseInt(daysMatch[1]) : 50;
              const dailyAmount = Math.ceil(goalAmount / suggestedDays);

              showAIMessage(
                `I've created a plan to help you save $${goalAmount.toLocaleString()}! You can achieve this by saving $${dailyAmount} daily for ${suggestedDays} days. Let's make it happen! 🎯`
              );

              document.getElementById(
                "message"
              ).textContent = `Save $${dailyAmount} per day for ${suggestedDays} days`;
              generateAIGrid(goalAmount, suggestedDays);
            } else {
              showAIMessage(
                "Let's start with a default savings plan. You can save $1000 in 50 days! 💰"
              );
              document.getElementById("message").textContent =
                "Save $20 per day for 50 days";
              generateAIGrid(1000, 50);
            }
          }
        }
      }

      function showUserMessage(message) {
        const chatMessages = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "chat-message user-message";
        messageDiv.textContent = message;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function showAIMessage(message) {
        const chatMessages = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "chat-message ai-message";
        messageDiv.textContent = message;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function generateAIGrid(totalAmount, days) {
        const grid = document.getElementById("grid");
        grid.innerHTML = "";

        // Round total amount to nearest multiple of 5
        totalAmount = Math.ceil(totalAmount / 5) * 5;

        // Calculate base daily amount (multiple of 5)
        const dailyAmount = Math.floor(totalAmount / days / 5) * 5;
        const extraAmount = totalAmount - dailyAmount * days;
        const extraDays = Math.ceil(extraAmount / 5);

        for (let i = 1; i <= days; i++) {
          const cell = document.createElement("div");
          cell.className = "grid-cell";

          // Add extra 5 to early days if needed to reach total
          if (i <= extraDays) {
            cell.textContent = `$${dailyAmount + 5}`;
          } else {
            cell.textContent = `$${dailyAmount}`;
          }

          cell.onclick = function () {
            this.classList.toggle("saved");
            updateProgressBar();
            saveProgress();
          };
          grid.appendChild(cell);
        }

        updateProgressBar();
      }

      function updateProgressBar() {
        const gridCells = document.querySelectorAll(".grid-cell");
        const savedCells = document.querySelectorAll(".grid-cell.saved");
        const progressBar = document.getElementById("progressBar");
        const progressText = document.getElementById("progressText");

        if (gridCells.length > 0) {
          const progress = (savedCells.length / gridCells.length) * 100;
          progressBar.style.width = progress + "%";

          // Calculate total amount saved
          let totalSaved = 0;
          savedCells.forEach((cell) => {
            const amount = parseInt(cell.textContent.replace("$", ""));
            totalSaved += amount;
          });

          // Calculate total goal amount
          let totalGoal = 0;
          gridCells.forEach((cell) => {
            const amount = parseInt(cell.textContent.replace("$", ""));
            totalGoal += amount;
          });

          progressText.textContent = `Saved: $${totalSaved.toLocaleString()} of $${totalGoal.toLocaleString()} (${Math.round(
            progress
          )}%)`;
        } else {
          progressBar.style.width = "0%";
          progressText.textContent = "Your savings progress";
        }
      }

      function downloadPDF() {
        let { jsPDF } = window.jspdf;
        let doc = new jsPDF({
          orientation: "portrait",
          unit: "mm",
          format: "a4",
        });

        // Get saving details
        const savingGoal = document.getElementById("savingGoal").value;

        // Add a soft pink background
        doc.setFillColor(255, 245, 247);
        doc.rect(0, 0, 210, 297, "F");

        // Add decorative header
        doc.setFillColor(255, 77, 141);
        doc.roundedRect(15, 15, 180, 35, 5, 5, "F");

        // Add title
        doc.setTextColor(255, 255, 255);
        doc.setFont("helvetica", "bold");
        doc.setFontSize(24);
        doc.text("Savings Tracker", 105, 35, { align: "center" });

        // Add saving goal details
        doc.setTextColor(255, 77, 141);
        doc.setFontSize(16);
        doc.text("My Savings Challenge", 105, 65, { align: "center" });

        // Add goal details with decorative box
        doc.setFillColor(255, 255, 255);
        doc.roundedRect(25, 70, 160, 30, 3, 3, "F");
        doc.setFontSize(14);
        doc.setTextColor(80, 80, 80);
        doc.text(`Goal: $${Number(savingGoal).toLocaleString()}`, 105, 82, {
          align: "center",
        });

        // Add motivational message
        doc.setFontSize(12);
        doc.setTextColor(255, 77, 141);
        doc.text(
          "Track your progress by marking each box as you save!",
          105,
          110,
          { align: "center" }
        );

        // Add grid with better styling
        let gridElement = document.getElementById("grid");
        html2canvas(gridElement, {
          scale: 2,
          backgroundColor: null,
        }).then((canvas) => {
          let imgData = canvas.toDataURL("image/png");
          let imgWidth = 160;
          let imgHeight = (canvas.height * imgWidth) / canvas.width;

          // Add a white background rectangle with rounded corners for the grid
          doc.setFillColor(255, 255, 255);
          doc.roundedRect(25, 115, 160, imgHeight + 10, 3, 3, "F");

          // Add the grid image
          doc.addImage(imgData, "PNG", 25, 120, imgWidth, imgHeight);

          // Add progress tracking section
          doc.setFillColor(255, 255, 255);
          doc.roundedRect(25, 120 + imgHeight + 15, 160, 30, 3, 3, "F");
          doc.setFontSize(12);
          doc.setTextColor(80, 80, 80);
          doc.text("Progress Tracking", 105, 120 + imgHeight + 30, {
            align: "center",
          });
          doc.text(
            "Start Date: _____________  Target End Date: _____________",
            105,
            120 + imgHeight + 40,
            { align: "center" }
          );

          // Add footer with decorative elements
          doc.setFillColor(255, 77, 141);
          doc.setFontSize(10);
          doc.setTextColor(153, 153, 153);
          doc.text("* Generated with love by Savings Tracker *", 105, 277, {
            align: "center",
          });

          // Save the PDF
          doc.save("my-savings-plan.pdf");
        });
      }

      function saveProgress() {
        const savedData = {
          savingGoal: document.getElementById("savingGoal").value,
          savedCells: [],
          gridValues: [], // Store the actual grid values
        };

        const gridCells = document.querySelectorAll(".grid-cell");
        gridCells.forEach((cell, index) => {
          savedData.gridValues.push(cell.innerText);
          if (cell.classList.contains("saved")) {
            savedData.savedCells.push(index);
          }
        });

        localStorage.setItem(
          "savingsTrackerProgress",
          JSON.stringify(savedData)
        );
        updateProgressBar();
      }

      function loadProgress() {
        const savedData = localStorage.getItem("savingsTrackerProgress");
        if (savedData) {
          applyLoadedProgress(JSON.parse(savedData));
        }
      }

      function applyLoadedProgress(savedData) {
        if (!savedData) return;

        // Restore form values
        document.getElementById("savingGoal").value = savedData.savingGoal;

        // Recreate grid with saved values
        const container = document.getElementById("grid");
        container.innerHTML = "";

        savedData.gridValues.forEach((value, index) => {
          let div = document.createElement("div");
          div.innerText = value;
          div.className = "grid-cell";
          if (savedData.savedCells.includes(index)) {
            div.classList.add("saved");
          }
          div.onclick = function () {
            this.classList.toggle("saved");
            updateProgressBar();
            saveProgress();
          };
          container.appendChild(div);
        });

        updateProgressBar();
      }

      function copyShareLink() {
        let url = window.location.href;
        navigator.clipboard
          .writeText(url)
          .then(() => {
            alert("Link copied to clipboard!");
          })
          .catch((err) => {
            console.error("Failed to copy link:", err);
          });
      }

      function clearChat() {
        // Clear all messages
        const chatMessages = document.getElementById("chatMessages");
        chatMessages.innerHTML = "";

        // Add back the initial greeting
        const greeting = document.createElement("div");
        greeting.className = "chat-message ai-message";
        greeting.textContent =
          "Hi! I'm SynAI 👋 I'm here to help you save money and achieve your financial goals! What would you like to save for?";
        chatMessages.appendChild(greeting);

        // Clear the input field
        document.getElementById("savingGoal").value = "";

        // Reset any active states
        if (isListening) {
          stopVoiceInput();
        }

        // Hide typing indicator if visible
        document.getElementById("typingIndicator").style.display = "none";
      }

      // Add event listener for page load
      document.addEventListener("DOMContentLoaded", function () {
        loadProgress();
        initSpeechRecognition();
      });
    </script>
  </body>
</html>
