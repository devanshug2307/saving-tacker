<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Savings Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://aistudio.google.com/js/client"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        text-align: center;
        background: linear-gradient(135deg, #fff5f7 0%, #ffe4e9 100%);
        padding: 20px;
        min-height: 100vh;
        margin: 0;
      }
      .container {
        width: 95%;
        max-width: 800px;
        margin: auto;
        background: rgba(255, 255, 255, 0.95);
        padding: 25px;
        border-radius: 30px;
        box-shadow: 0 10px 30px rgba(255, 77, 141, 0.15);
        backdrop-filter: blur(10px);
        transition: transform 0.3s ease;
      }
      .container:hover {
        transform: translateY(-5px);
      }
      .savings-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        position: relative;
        background: linear-gradient(135deg, #ff4d8d 0%, #ff6b9c 100%);
        border-radius: 20px;
        box-shadow: 0 5px 15px rgba(255, 77, 141, 0.2);
      }
      .savings-header h2 {
        color: white;
        font-size: 32px;
        font-weight: 700;
        margin: 0;
        padding: 10px 0;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }
      .savings-header::before {
        content: "ðŸ’°";
        font-size: 24px;
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
      }
      .input-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
        margin: 25px 0;
        padding: 0 15px;
      }
      .input-container input {
        flex: 1;
        min-width: 200px;
        padding: 15px 25px;
        border: 2px solid rgba(255, 77, 141, 0.2);
        border-radius: 30px;
        outline: none;
        font-size: 16px;
        transition: all 0.3s ease;
        background: white;
      }
      .input-container input:focus {
        border-color: #ff4d8d;
        box-shadow: 0 0 0 4px rgba(255, 77, 141, 0.1);
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
        gap: 12px;
        padding: 20px;
        margin: 30px auto;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 20px;
        box-shadow: inset 0 0 15px rgba(255, 77, 141, 0.1);
      }
      .grid-cell {
        background: white;
        border: none;
        border-radius: 15px;
        padding: 15px 10px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 16px;
        box-shadow: 0 3px 10px rgba(255, 77, 141, 0.1);
        position: relative;
        overflow: hidden;
      }
      .grid-cell:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 5px 15px rgba(255, 77, 141, 0.2);
      }
      .grid-cell.saved {
        background: linear-gradient(135deg, #ff4d8d 0%, #ff6b9c 100%);
        color: white;
        animation: savePop 0.3s ease;
      }
      @keyframes savePop {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }
      .message {
        color: #ff4d8d;
        font-size: 18px;
        font-weight: 600;
        padding: 20px;
        margin: 25px 0;
        background: rgba(255, 209, 220, 0.2);
        border-radius: 20px;
        line-height: 1.6;
        border-left: 5px solid #ff4d8d;
        animation: slideIn 0.5s ease;
      }
      @keyframes slideIn {
        from {
          transform: translateX(-20px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      .progress-section {
        margin: 35px auto;
        max-width: 600px;
        padding: 25px;
        background: white;
        border-radius: 25px;
        box-shadow: 0 5px 20px rgba(255, 77, 141, 0.1);
      }
      .progress-bar-container {
        width: 100%;
        height: 15px;
        background: rgba(255, 209, 220, 0.3);
        border-radius: 10px;
        margin: 15px auto;
        overflow: hidden;
        position: relative;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(to right, #ff4d8d, #ff6b9c);
        border-radius: 10px;
        transition: width 0.8s ease;
        position: relative;
        overflow: hidden;
      }
      .progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.3) 50%,
          rgba(255, 255, 255, 0) 100%
        );
        animation: shimmer 2s infinite;
      }
      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }
      .progress-text {
        color: #ff4d8d;
        font-size: 16px;
        font-weight: 600;
        text-align: center;
        margin: 15px 0;
        text-shadow: 0 1px 2px rgba(255, 77, 141, 0.1);
      }
      .chat-container {
        max-width: 600px;
        margin: 30px auto;
        padding: 20px;
        background: white;
        border-radius: 25px;
        box-shadow: 0 5px 20px rgba(255, 77, 141, 0.1);
      }
      .chat-message {
        margin: 15px 0;
        padding: 15px 20px;
        border-radius: 20px;
        max-width: 85%;
        position: relative;
        animation: messageSlide 0.3s ease;
      }
      @keyframes messageSlide {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      .ai-message {
        background: linear-gradient(135deg, #ffd1dc 0%, #ffe4e9 100%);
        margin-right: auto;
        color: #ff4d8d;
        border-bottom-left-radius: 5px;
      }
      .user-message {
        background: linear-gradient(135deg, #ff4d8d 0%, #ff6b9c 100%);
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 5px;
      }
      .button-container {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin: 30px 0;
      }
      button {
        cursor: pointer;
        background: linear-gradient(135deg, #ff4d8d 0%, #ff6b9c 100%);
        color: white;
        border: none;
        border-radius: 30px;
        padding: 15px 30px;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(255, 77, 141, 0.2);
        position: relative;
        overflow: hidden;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 77, 141, 0.3);
      }
      button:active {
        transform: translateY(1px);
      }
      .voice-btn {
        width: 50px !important;
        height: 50px !important;
        padding: 0 !important;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        border-radius: 50% !important;
      }
      .voice-btn.listening {
        animation: pulseRing 1.5s infinite;
      }
      @keyframes pulseRing {
        0% {
          box-shadow: 0 0 0 0 rgba(255, 77, 141, 0.5);
        }
        70% {
          box-shadow: 0 0 0 15px rgba(255, 77, 141, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(255, 77, 141, 0);
        }
      }
      .share-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        margin-top: 20px;
      }
      .share-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 20px;
        color: white;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.3s ease;
      }
      .whatsapp {
        background-color: #25d366;
      }
      .facebook {
        background-color: #4267b2;
      }
      .pinterest {
        background-color: #e60023;
      }
      .copy {
        background-color: #ff4d8d;
      }
      /* Mobile styles (up to 480px) */
      @media screen and (max-width: 480px) {
        .grid {
          grid-template-columns: repeat(4, 1fr);
          gap: 6px;
        }
        .grid-cell {
          padding: 8px 4px;
          min-height: 35px;
          font-size: 13px;
        }
        .input-container select,
        .input-container input,
        .input-container button {
          font-size: 13px;
          padding: 8px 12px;
        }
      }
      /* Tablet styles (481px to 768px) */
      @media screen and (min-width: 481px) and (max-width: 768px) {
        .grid {
          grid-template-columns: repeat(5, 1fr);
          gap: 8px;
        }
        .grid-cell {
          min-height: 38px;
          font-size: 13px;
          padding: 6px;
        }
      }
      /* Desktop styles (769px and above) */
      @media screen and (min-width: 769px) {
        .grid {
          grid-template-columns: repeat(6, 1fr);
          gap: 10px;
        }
        .grid-cell {
          min-height: 42px;
          font-size: 14px;
          padding: 8px;
        }
      }
      .clear-chat-btn {
        background-color: #ff4d8d;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 8px 15px;
        font-size: 14px;
        cursor: pointer;
        margin-top: 15px;
        transition: all 0.3s ease;
        opacity: 0.8;
        display: flex;
        align-items: center;
        gap: 5px;
        margin-left: auto;
      }
      .clear-chat-btn:hover {
        opacity: 1;
        transform: translateY(-2px);
      }
      .clear-chat-btn i {
        font-size: 12px;
      }
      .color-picker-container {
        margin-top: 30px;
        border-top: 2px dashed rgba(255, 77, 141, 0.2);
        padding-top: 30px;
      }
      .color-picker-title {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        margin-bottom: 25px;
      }
      .color-picker-title i {
        font-size: 24px;
        margin-bottom: 10px;
        color: #ff4d8d;
      }
      .color-picker-subtitle {
        font-size: 14px;
        color: #666;
        margin-top: 5px;
        font-weight: normal;
        text-transform: none;
      }
      .color-type-switch {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 25px;
        padding: 5px;
        background: rgba(255, 77, 141, 0.1);
        border-radius: 20px;
        padding: 5px;
      }
      .color-type-btn {
        padding: 12px 25px;
        border: none;
        border-radius: 15px;
        background: transparent;
        color: #ff4d8d;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 14px;
        position: relative;
        z-index: 1;
      }
      .color-type-btn.active {
        background: white;
        color: #ff4d8d;
        box-shadow: 0 3px 10px rgba(255, 77, 141, 0.15);
      }
      .color-type-btn:hover:not(.active) {
        background: rgba(255, 255, 255, 0.5);
      }
      .color-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        gap: 15px;
        justify-content: center;
        margin: 25px 0;
        padding: 10px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 20px;
      }
      .color-option {
        width: 50px;
        height: 50px;
        border-radius: 15px;
        cursor: pointer;
        border: 3px solid transparent;
        transition: all 0.3s ease;
        position: relative;
        margin: auto;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }
      .color-option:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }
      .color-option.selected {
        border-color: #ff4d8d;
        transform: scale(1.1);
      }
      .color-option.selected::after {
        content: "âœ“";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 20px;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }
      .custom-color-input {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 20px;
      }
      .custom-color-input input[type="color"] {
        width: 70px;
        height: 40px;
        padding: 5px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: white;
        box-shadow: 0 3px 10px rgba(255, 77, 141, 0.1);
        transition: all 0.3s ease;
      }
      .custom-color-input input[type="color"]:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 77, 141, 0.2);
      }
      .custom-color-input label {
        font-size: 14px;
        font-weight: 600;
        color: #ff4d8d;
        background: white;
        padding: 10px 20px;
        border-radius: 15px;
        box-shadow: 0 3px 10px rgba(255, 77, 141, 0.1);
      }
      .color-preview {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 25px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 1000;
        animation: slideUp 0.3s ease;
      }
      @keyframes slideUp {
        from {
          transform: translateY(100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      .color-preview-box {
        width: 30px;
        height: 30px;
        border-radius: 8px;
      }
      .color-preview-text {
        font-size: 14px;
        font-weight: 600;
        color: #666;
      }
      .welcome-section {
        background: white;
        border-radius: 30px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(255, 77, 141, 0.15);
      }

      .welcome-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .welcome-header h1 {
        color: #ff4d8d;
        font-size: 36px;
        margin-bottom: 10px;
      }

      .welcome-subtitle {
        color: #666;
        font-size: 18px;
        margin: 0;
      }

      .quick-start-section {
        padding: 20px;
        background: rgba(255, 245, 247, 0.5);
        border-radius: 20px;
      }

      .guide-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 30px;
      }

      .guide-header i {
        font-size: 24px;
        color: #ff4d8d;
      }

      .guide-header h3 {
        color: #ff4d8d;
        font-size: 24px;
        margin: 0;
      }

      .guide-subtitle {
        color: #666;
        font-size: 14px;
        margin: 0;
      }

      .steps-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .step {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(255, 77, 141, 0.1);
        display: flex;
        align-items: flex-start;
        gap: 15px;
      }

      .step-icon {
        width: 48px;
        height: 48px;
        min-width: 48px;
        background: #ff4d8d;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
      }

      .step-content {
        flex: 1;
      }

      .step-content h4 {
        color: #ff4d8d;
        margin: 0 0 8px 0;
        font-size: 18px;
      }

      .step-content p {
        color: #666;
        margin: 0;
        font-size: 14px;
        line-height: 1.4;
      }

      @media screen and (max-width: 768px) {
        .steps-container {
          grid-template-columns: 1fr;
        }

        .step {
          padding: 15px;
        }

        .step-icon {
          width: 40px;
          height: 40px;
          min-width: 40px;
          font-size: 20px;
        }
      }

      [data-tooltip] {
        position: relative;
        cursor: help;
      }

      [data-tooltip]:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 14px;
        white-space: nowrap;
        z-index: 1000;
      }

      .grid-cell {
        position: relative;
      }

      .grid-cell:hover::after {
        content: "Click to mark as saved";
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        z-index: 1000;
      }

      .grid-cell.saved:hover::after {
        content: "Click to unmark";
      }

      .input-container {
        position: relative;
      }

      .input-container::before {
        content: "ðŸ’­";
        position: absolute;
        left: 25px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 20px;
        z-index: 1;
      }

      .input-container input {
        padding-left: 55px;
      }

      .voice-btn {
        position: relative;
      }

      .voice-btn:hover::after {
        content: "Use voice input";
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        z-index: 1000;
        margin-bottom: 5px;
      }

      .chat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: rgba(255, 77, 141, 0.1);
        border-radius: 15px 15px 0 0;
        margin-bottom: 15px;
      }

      .chat-header h3 {
        color: #ff4d8d;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .example-prompts {
        margin-top: 15px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .example-prompt {
        background: rgba(255, 255, 255, 0.5);
        padding: 10px 15px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        color: #ff4d8d;
      }

      .example-prompt:hover {
        background: rgba(255, 255, 255, 0.8);
        transform: translateX(5px);
      }

      .typing-indicator {
        padding: 10px;
        display: none;
      }

      .typing-indicator span {
        display: inline-block;
        width: 8px;
        height: 8px;
        background: #ff4d8d;
        border-radius: 50%;
        margin: 0 3px;
        animation: typing 1s infinite;
      }

      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      .shape-picker-container {
        margin-top: 30px;
        border-top: 2px dashed rgba(255, 77, 141, 0.2);
        padding-top: 30px;
      }

      .shape-picker-title {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        margin-bottom: 25px;
      }

      .shape-picker-title i {
        font-size: 24px;
        margin-bottom: 10px;
        color: #ff4d8d;
      }

      .shape-picker-subtitle {
        font-size: 14px;
        color: #666;
        margin-top: 5px;
        font-weight: normal;
        text-transform: none;
      }

      .shape-options {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
        margin: 20px 0;
      }

      .shape-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 15px 25px;
        border: 2px solid transparent;
        border-radius: 15px;
        background: white;
        color: #ff4d8d;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(255, 77, 141, 0.1);
      }

      .shape-btn i {
        font-size: 24px;
      }

      .shape-btn span {
        font-size: 14px;
        font-weight: 600;
      }

      .shape-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(255, 77, 141, 0.2);
      }

      .shape-btn.active {
        border-color: #ff4d8d;
        background: rgba(255, 77, 141, 0.1);
      }

      /* Shape Classes for Grid Cells */
      .grid-cell.circle {
        border-radius: 50%;
      }

      .grid-cell.envelope {
        clip-path: polygon(0% 0%, 100% 0%, 100% 75%, 50% 100%, 0% 75%);
      }

      .grid-cell.star {
        clip-path: polygon(
          50% 0%,
          61% 35%,
          98% 35%,
          68% 57%,
          79% 91%,
          50% 70%,
          21% 91%,
          32% 57%,
          2% 35%,
          39% 35%
        );
      }

      .grid-cell.heart {
        clip-path: path(
          "M12 4.248c-3.148-5.402-12-3.825-12 2.944 0 4.661 5.571 9.427 12 15.808 6.43-6.381 12-11.147 12-15.808 0-6.792-8.875-8.306-12-2.944z"
        );
      }

      /* Adjust hover effects for shaped cells */
      .grid-cell.circle:hover,
      .grid-cell.envelope:hover,
      .grid-cell.star:hover,
      .grid-cell.heart:hover {
        transform: translateY(-3px) scale(1.05);
      }
    </style>
  </head>
  <body>
    <div class="savings-tracker-container">
      <div class="container">
        <div class="welcome-section">
          <div class="welcome-header">
            <h1>Welcome to Savings Tracker</h1>
            <p class="welcome-subtitle">
              Your personal AI-powered assistant to help you save money
              effectively
            </p>
          </div>
          <div class="quick-start-section">
            <div class="guide-header">
              <i class="fas fa-rocket"></i>
              <h3>Quick Start Guide</h3>
              <p class="guide-subtitle">Three simple steps to start saving</p>
            </div>
            <div class="steps-container">
              <div class="step">
                <div class="step-icon">
                  <i class="fas fa-comments-dollar"></i>
                </div>
                <div class="step-content">
                  <h4>Tell Me Your Goal</h4>
                  <p>
                    Type or say something like "I want to save $1000 in 50 days"
                    - I'll create your daily saving plan instantly!
                  </p>
                </div>
              </div>
              <div class="step">
                <div class="step-icon">
                  <i class="fas fa-calendar-check"></i>
                </div>
                <div class="step-content">
                  <h4>Save Daily</h4>
                  <p>
                    Your grid will show how much to save each day. Just click a
                    box to mark it as saved - it's that easy!
                  </p>
                </div>
              </div>
              <div class="step">
                <div class="step-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <div class="step-content">
                  <h4>Watch Your Progress</h4>
                  <p>
                    See your savings grow in real-time with the progress bar.
                    Customize colors to make it your own!
                  </p>
                </div>
              </div>
              <div class="step">
                <div class="step-icon">
                  <i class="fas fa-file-download"></i>
                </div>
                <div class="step-content">
                  <h4>Download Your Plan</h4>
                  <p>
                    Get a beautifully formatted PDF of your savings plan to
                    track offline or share with others!
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="savings-header">
          <h2>Start Your Savings Journey</h2>
        </div>
        <div
          class="input-container"
          data-tooltip="Type your savings goal or use voice input"
        >
          <input
            type="text"
            id="savingGoal"
            placeholder="Tell me your saving goal... (e.g., 'I want to save $1000 in 50 days')"
            onkeypress="handleKeyPress(event)"
          />
          <button
            id="voiceInputBtn"
            onclick="toggleVoiceInput()"
            class="voice-btn"
            data-tooltip="Click to use voice input"
          >
            <i class="fas fa-microphone"></i>
          </button>
        </div>
        <div id="message" class="message" style="display: none"></div>
        <div class="progress-section">
          <div class="progress-text" id="progressText">
            Your savings progress
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
        </div>

        <!-- Grid Section -->
        <div class="grid" id="grid"></div>
        <div class="button-container">
          <button onclick="downloadPDF()">Download PDF</button>
        </div>
        <div class="share-container">
          <button onclick="copyShareLink()" class="share-btn copy">
            Copy Link
          </button>
        </div>

        <!-- Chat Section -->
        <div class="chat-container" id="chatContainer">
          <div class="chat-header">
            <h3><i class="fas fa-robot"></i> Your Savings Assistant</h3>
            <button
              onclick="clearChat()"
              class="clear-chat-btn"
              data-tooltip="Clear conversation history"
            >
              <i class="fas fa-trash"></i> Clear Chat
            </button>
          </div>
          <div id="chatMessages">
            <div class="chat-message ai-message">
              Hi! I'm your savings assistant ðŸ‘‹ I'm here to help you save money
              and achieve your financial goals! Try saying something like:
              <div class="example-prompts">
                <div class="example-prompt" onclick="useExample(this)">
                  I want to save $1000 in 50 days
                </div>
                <div class="example-prompt" onclick="useExample(this)">
                  Help me save $500 in 30 days with max $20 per day
                </div>
                <div class="example-prompt" onclick="useExample(this)">
                  I need to save for a vacation
                </div>
              </div>
            </div>
          </div>
          <div class="typing-indicator" id="typingIndicator">
            <span>â€¢</span><span>â€¢</span><span>â€¢</span>
          </div>
        </div>

        <!-- Customization Section -->
        <div class="color-picker-container">
          <div class="color-picker-title">
            <i class="fas fa-paint-brush"></i> Customize Your Grid
            <div class="color-picker-subtitle">
              Personalize the colors of your savings grid
            </div>
          </div>
          <div class="color-type-switch">
            <button
              class="color-type-btn active"
              onclick="switchColorType('unsaved')"
            >
              <i class="fas fa-square"></i> Unsaved Cells
            </button>
            <button class="color-type-btn" onclick="switchColorType('saved')">
              <i class="fas fa-check-square"></i> Saved Cells
            </button>
          </div>
          <div class="color-options">
            <div
              class="color-option"
              style="background: #ffd1dc"
              onclick="selectColor('#ffd1dc')"
              data-color="#ffd1dc"
            ></div>
            <div
              class="color-option"
              style="background: #ff4d8d"
              onclick="selectColor('#ff4d8d')"
              data-color="#ff4d8d"
            ></div>
            <div
              class="color-option"
              style="background: #4caf50"
              onclick="selectColor('#4CAF50')"
              data-color="#4CAF50"
            ></div>
            <div
              class="color-option"
              style="background: #2196f3"
              onclick="selectColor('#2196F3')"
              data-color="#2196F3"
            ></div>
            <div
              class="color-option"
              style="background: #9c27b0"
              onclick="selectColor('#9C27B0')"
              data-color="#9C27B0"
            ></div>
            <div
              class="color-option"
              style="background: #ff9800"
              onclick="selectColor('#FF9800')"
              data-color="#FF9800"
            ></div>
          </div>
          <div class="custom-color-input">
            <input
              type="color"
              id="customColor"
              onchange="selectColor(this.value)"
              value="#ff4d8d"
            />
            <label for="customColor">
              <i class="fas fa-paint-brush"></i> Custom Color
            </label>
          </div>
        </div>

        <!-- Shape Selector Section -->
        <div class="shape-picker-container">
          <div class="shape-picker-title">
            <i class="fas fa-shapes"></i> Choose Grid Shape
            <div class="shape-picker-subtitle">
              Select different shapes for your savings grid cells
            </div>
          </div>
          <div class="shape-options">
            <button
              class="shape-btn active"
              data-shape="square"
              onclick="selectShape('square')"
            >
              <i class="fas fa-square"></i>
              <span>Square</span>
            </button>
            <button
              class="shape-btn"
              data-shape="circle"
              onclick="selectShape('circle')"
            >
              <i class="fas fa-circle"></i>
              <span>Circle</span>
            </button>
            <button
              class="shape-btn"
              data-shape="envelope"
              onclick="selectShape('envelope')"
            >
              <i class="fas fa-envelope"></i>
              <span>Envelope</span>
            </button>
            <button
              class="shape-btn"
              data-shape="star"
              onclick="selectShape('star')"
            >
              <i class="fas fa-star"></i>
              <span>Star</span>
            </button>
            <button
              class="shape-btn"
              data-shape="heart"
              onclick="selectShape('heart')"
            >
              <i class="fas fa-heart"></i>
              <span>Heart</span>
            </button>
          </div>
        </div>
        <div id="colorPreview" class="color-preview" style="display: none">
          <div class="color-preview-box" id="colorPreviewBox"></div>
          <div class="color-preview-text" id="colorPreviewText"></div>
        </div>
      </div>
    </div>
    <script>
      let recognition = null;
      let isListening = false;
      let currentColorType = "unsaved";
      let gridColors = {
        saved: "#ff4d8d",
        unsaved: "#ffd1dc",
      };
      let currentShape = "square";

      // Load saved colors from localStorage
      function loadSavedColors() {
        const savedColors = localStorage.getItem("gridColors");
        if (savedColors) {
          gridColors = JSON.parse(savedColors);
          updateGridColors();
        }
      }

      // Save colors to localStorage
      function saveColors() {
        localStorage.setItem("gridColors", JSON.stringify(gridColors));
      }

      // Switch between saved and unsaved color selection
      function switchColorType(type) {
        currentColorType = type;
        document.querySelectorAll(".color-type-btn").forEach((btn) => {
          btn.classList.toggle(
            "active",
            btn.textContent.toLowerCase().includes(type)
          );
        });

        // Update selected state in color options
        document.querySelectorAll(".color-option").forEach((option) => {
          const color = option.getAttribute("data-color");
          option.classList.toggle(
            "selected",
            color === gridColors[currentColorType]
          );
        });

        // Update custom color input
        document.getElementById("customColor").value =
          gridColors[currentColorType];
      }

      // Select a color and apply it to the grid
      function selectColor(color) {
        gridColors[currentColorType] = color;

        // Update selected state in color options
        document.querySelectorAll(".color-option").forEach((option) => {
          option.classList.toggle(
            "selected",
            option.getAttribute("data-color") === color
          );
        });

        updateGridColors();
        saveColors();
        showColorPreview(color);

        // Add ripple effect to selected color option
        const selectedOption = document.querySelector(
          `.color-option[data-color="${color}"]`
        );
        if (selectedOption) {
          const ripple = document.createElement("div");
          ripple.className = "ripple";
          selectedOption.appendChild(ripple);
          setTimeout(() => ripple.remove(), 1000);
        }
      }

      // Update grid colors based on current selection
      function updateGridColors() {
        const style = document.createElement("style");
        style.textContent = `
          .grid-cell {
            background-color: ${gridColors.unsaved} !important;
            border-color: ${gridColors.unsaved} !important;
          }
          .grid-cell.saved {
            background-color: ${gridColors.saved} !important;
            border-color: ${gridColors.saved} !important;
          }
        `;

        // Remove any existing custom styles
        const existingStyle = document.getElementById("gridColorStyles");
        if (existingStyle) {
          existingStyle.remove();
        }

        style.id = "gridColorStyles";
        document.head.appendChild(style);
      }

      function initSpeechRecognition() {
        if ("webkitSpeechRecognition" in window) {
          recognition = new webkitSpeechRecognition();
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = "en-US";

          recognition.onstart = function () {
            isListening = true;
            document.getElementById("voiceInputBtn").classList.add("listening");
            showAIMessage("I'm listening... Speak your saving goal!");
          };

          recognition.onresult = function (event) {
            const voiceInput = event.results[0][0].transcript;
            document.getElementById("savingGoal").value = voiceInput;
            handleVoiceInput(voiceInput);
          };

          recognition.onerror = function (event) {
            console.error("Speech recognition error:", event.error);
            showAIMessage(
              "Sorry, I couldn't hear you. Please try again or type your goal."
            );
            stopVoiceInput();
          };

          recognition.onend = function () {
            stopVoiceInput();
          };
        } else {
          document.getElementById("voiceInputBtn").style.display = "none";
          console.warn("Speech recognition not supported");
        }
      }

      function toggleVoiceInput() {
        if (!recognition) {
          initSpeechRecognition();
        }

        if (isListening) {
          stopVoiceInput();
        } else {
          startVoiceInput();
        }
      }

      function startVoiceInput() {
        if (recognition) {
          recognition.start();
        }
      }

      function stopVoiceInput() {
        if (recognition) {
          recognition.stop();
          isListening = false;
          document
            .getElementById("voiceInputBtn")
            .classList.remove("listening");
        }
      }

      function handleVoiceInput(voiceInput) {
        if (voiceInput.trim()) {
          showUserMessage(voiceInput);
          handleKeyPress({ key: "Enter" });
        }
      }

      function checkSavingsFeasibility(totalAmount, days, maxDailyAmount) {
        const requiredDailyAmount = Math.ceil(totalAmount / days);
        return {
          feasible: maxDailyAmount
            ? requiredDailyAmount <= maxDailyAmount
            : true,
          requiredDailyAmount: requiredDailyAmount,
        };
      }

      async function handleKeyPress(event) {
        if (event.key === "Enter") {
          const savingGoal = document.getElementById("savingGoal").value;
          if (!savingGoal) {
            showAIMessage(
              "Please tell me what you'd like to save for. It can be anything - a vacation, new gadget, or emergency fund!"
            );
            return;
          }

          // Show user message
          showUserMessage(savingGoal);

          // Show typing indicator
          document.getElementById("typingIndicator").style.display = "block";

          try {
            // Extract numbers from the saving goal using regex
            const amountMatch = savingGoal.match(
              /(?:save|goal|total)?\s*\$?\s*(\d+(?:,\d{3})*(?:\.\d{2})?)/i
            );
            const daysMatch = savingGoal.match(/(\d+)\s*days?/i);
            const maxDailyMatch = savingGoal.match(
              /max(?:imum)?\s*(?:\$\s*?|\s+)?(\d+)(?:\s*dollars?)?\s*(?:per\s*day|daily|a\s*day)/i
            );

            if (amountMatch && daysMatch) {
              const totalAmount = parseFloat(amountMatch[1].replace(/,/g, ""));
              const days = parseInt(daysMatch[1]);
              const maxDailyAmount = maxDailyMatch
                ? parseFloat(maxDailyMatch[1].replace(/,/g, ""))
                : null;

              const feasibility = checkSavingsFeasibility(
                totalAmount,
                days,
                maxDailyAmount
              );

              if (!maxDailyAmount || feasibility.feasible) {
                showAIMessage(
                  `Great! Your goal to save $${totalAmount.toLocaleString()} in ${days} days${
                    maxDailyAmount
                      ? ` with a maximum daily saving of $${maxDailyAmount}`
                      : ""
                  } is achievable! You'll need to save $${
                    feasibility.requiredDailyAmount
                  } per day to reach your goal. Let's make it happen! ðŸ’ª`
                );

                document.getElementById("message").style.display = "block";
                document.getElementById("message").textContent = `Save $${
                  feasibility.requiredDailyAmount
                } per day for ${days} days to reach $${totalAmount.toLocaleString()}`;

                generateAIGrid(totalAmount, days);
              } else {
                const suggestedDays = Math.ceil(totalAmount / maxDailyAmount);
                showAIMessage(
                  `I notice that saving $${totalAmount.toLocaleString()} in ${days} days with a maximum daily saving of $${maxDailyAmount} isn't feasible. You would need to save $${
                    feasibility.requiredDailyAmount
                  } per day, which exceeds your maximum.\n\nHere are some options:\n` +
                    `1. Extend your saving period to ${suggestedDays} days to stay within your daily limit\n` +
                    `2. Increase your maximum daily saving amount to $${feasibility.requiredDailyAmount}\n` +
                    `3. Reduce your total saving goal to $${(
                      maxDailyAmount * days
                    ).toLocaleString()} or less\n\n` +
                    `Would you like to try again with adjusted numbers? ðŸ¤”`
                );
                return;
              }
            } else {
              // Continue with the existing AI response logic for other cases
              const response = await fetch(
                "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyDh4MLDc66T0YN1Gzv2qKjSlLQ1vYR_HzU",
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    contents: [
                      {
                        parts: [
                          {
                            text: `Generate a savings plan for the goal: ${savingGoal}. 
                            Return the response in JSON format with these fields:
                            - totalAmount (number)
                            - numberOfDays (number between 30-100)
                            - dailyAmount (number)
                            - encouragingMessage (string)
                            Example: {
                              "totalAmount": 1000, 
                              "numberOfDays": 50, 
                              "dailyAmount": 20,
                              "encouragingMessage": "That's a great goal! I'll help you save $1000 in 50 days."
                            }`,
                          },
                        ],
                      },
                    ],
                  }),
                }
              );

              // Hide typing indicator
              document.getElementById("typingIndicator").style.display = "none";

              if (!response.ok) {
                throw new Error("Failed to get response from AI");
              }

              const data = await response.json();
              if (
                !data.candidates ||
                !data.candidates[0] ||
                !data.candidates[0].content ||
                !data.candidates[0].content.parts[0].text
              ) {
                throw new Error("Invalid response format from AI");
              }

              const aiText = data.candidates[0].content.parts[0].text;
              const jsonMatch = aiText.match(/\{.*\}/s);
              if (!jsonMatch) {
                throw new Error("Could not find JSON in AI response");
              }

              const planData = JSON.parse(jsonMatch[0]);

              // Show AI response message
              showAIMessage(
                planData.encouragingMessage ||
                  `Great! I'll help you save $${planData.totalAmount.toLocaleString()} over ${
                    planData.numberOfDays
                  } days. You'll need to save $${
                    planData.dailyAmount
                  } per day to reach your goal! ðŸ’ª`
              );

              document.getElementById("message").style.display = "block";
              document.getElementById("message").textContent = `Save $${
                planData.dailyAmount
              } per day for ${
                planData.numberOfDays
              } days to reach $${planData.totalAmount.toLocaleString()}`;

              generateAIGrid(planData.totalAmount, planData.numberOfDays);
            }
          } catch (error) {
            console.error("Error:", error);
            document.getElementById("typingIndicator").style.display = "none";

            // Extract amount from the saving goal
            const amount = savingGoal.match(/\$?\d+/);
            if (amount) {
              const goalAmount = parseInt(amount[0].replace("$", ""));
              const daysMatch = savingGoal.match(/(\d+)\s*days?/i);
              const suggestedDays = daysMatch ? parseInt(daysMatch[1]) : 50;
              const dailyAmount = Math.ceil(goalAmount / suggestedDays);

              showAIMessage(
                `I've created a plan to help you save $${goalAmount.toLocaleString()}! You can achieve this by saving $${dailyAmount} daily for ${suggestedDays} days. Let's make it happen! ðŸŽ¯`
              );

              document.getElementById(
                "message"
              ).textContent = `Save $${dailyAmount} per day for ${suggestedDays} days`;
              generateAIGrid(goalAmount, suggestedDays);
            } else {
              showAIMessage(
                "Let's start with a default savings plan. You can save $1000 in 50 days! ðŸ’°"
              );
              document.getElementById("message").textContent =
                "Save $20 per day for 50 days";
              generateAIGrid(1000, 50);
            }
          }
        }
      }

      function useExample(element) {
        const text = element.textContent.trim();
        document.getElementById("savingGoal").value = text;
        handleKeyPress({ key: "Enter" });
      }

      function clearChat() {
        // Clear all messages
        const chatMessages = document.getElementById("chatMessages");
        chatMessages.innerHTML = "";

        // Add back the initial greeting with examples
        const greeting = document.createElement("div");
        greeting.className = "chat-message ai-message";
        greeting.innerHTML = `
          Hi! I'm your savings assistant ðŸ‘‹ I'm here to help you save money and achieve your financial goals! Try saying something like:
          <div class="example-prompts">
            <div class="example-prompt" onclick="useExample(this)">I want to save $1000 in 50 days</div>
            <div class="example-prompt" onclick="useExample(this)">Help me save $500 in 30 days with max $20 per day</div>
            <div class="example-prompt" onclick="useExample(this)">I need to save for a vacation</div>
          </div>
        `;
        chatMessages.appendChild(greeting);

        // Clear the input field
        document.getElementById("savingGoal").value = "";

        // Reset any active states
        if (isListening) {
          stopVoiceInput();
        }

        // Hide typing indicator if visible
        document.getElementById("typingIndicator").style.display = "none";

        // Clear the grid and progress
        document.getElementById("grid").innerHTML = "";
        document.getElementById("message").style.display = "none";
        updateProgressBar();
      }

      function showUserMessage(message) {
        const chatMessages = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "chat-message user-message";
        messageDiv.textContent = message;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // Show typing indicator
        document.getElementById("typingIndicator").style.display = "block";
      }

      function showAIMessage(message) {
        // Hide typing indicator
        document.getElementById("typingIndicator").style.display = "none";

        const chatMessages = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "chat-message ai-message";

        // Add typing animation effect
        let i = 0;
        messageDiv.textContent = "";
        chatMessages.appendChild(messageDiv);

        function typeWriter() {
          if (i < message.length) {
            messageDiv.textContent += message.charAt(i);
            i++;
            chatMessages.scrollTop = chatMessages.scrollHeight;
            setTimeout(typeWriter, 20);
          }
        }

        typeWriter();
      }

      function generateAIGrid(totalAmount, days) {
        const grid = document.getElementById("grid");
        grid.innerHTML = "";

        // Round total amount to nearest multiple of 5
        totalAmount = Math.ceil(totalAmount / 5) * 5;

        // Calculate base daily amount (multiple of 5)
        const dailyAmount = Math.floor(totalAmount / days / 5) * 5;
        const extraAmount = totalAmount - dailyAmount * days;
        const extraDays = Math.ceil(extraAmount / 5);

        for (let i = 1; i <= days; i++) {
          const cell = document.createElement("div");
          cell.className = `grid-cell ${currentShape}`;

          // Add extra 5 to early days if needed to reach total
          if (i <= extraDays) {
            cell.textContent = `$${dailyAmount + 5}`;
          } else {
            cell.textContent = `$${dailyAmount}`;
          }

          cell.onclick = function () {
            this.classList.toggle("saved");
            updateProgressBar();
            saveProgress();
            updateGridCellTooltips();
          };
          grid.appendChild(cell);
        }

        updateGridCellTooltips();
        updateProgressBar();
      }

      function updateProgressBar() {
        const gridCells = document.querySelectorAll(".grid-cell");
        const savedCells = document.querySelectorAll(".grid-cell.saved");
        const progressBar = document.getElementById("progressBar");
        const progressText = document.getElementById("progressText");

        if (gridCells.length > 0) {
          const progress = (savedCells.length / gridCells.length) * 100;
          progressBar.style.width = progress + "%";

          // Calculate total amount saved
          let totalSaved = 0;
          savedCells.forEach((cell) => {
            const amount = parseInt(cell.textContent.replace("$", ""));
            totalSaved += amount;
          });

          // Calculate total goal amount
          let totalGoal = 0;
          gridCells.forEach((cell) => {
            const amount = parseInt(cell.textContent.replace("$", ""));
            totalGoal += amount;
          });

          progressText.textContent = `Saved: $${totalSaved.toLocaleString()} of $${totalGoal.toLocaleString()} (${Math.round(
            progress
          )}%)`;
        } else {
          progressBar.style.width = "0%";
          progressText.textContent = "Your savings progress";
        }
      }

      function downloadPDF() {
        let { jsPDF } = window.jspdf;
        let doc = new jsPDF({
          orientation: "portrait",
          unit: "mm",
          format: "a4",
        });

        // Get saving details
        const savingGoal = document.getElementById("savingGoal").value;
        const messageText = document.getElementById("message").textContent;
        const progressText =
          document.getElementById("progressText").textContent;

        // PDF dimensions
        const pageWidth = 210;
        const pageHeight = 297;
        const margin = 20;
        const usableWidth = pageWidth - 2 * margin;

        // Add a soft pink background
        doc.setFillColor(255, 245, 247);
        doc.rect(0, 0, pageWidth, pageHeight, "F");

        // Add decorative header
        doc.setFillColor(255, 77, 141);
        doc.roundedRect(margin, margin, usableWidth, 25, 5, 5, "F");

        // Add title
        doc.setTextColor(255, 255, 255);
        doc.setFont("helvetica", "bold");
        doc.setFontSize(24);
        doc.text("Savings Tracker", pageWidth / 2, margin + 17, {
          align: "center",
        });

        // Add saving goal details with decorative box
        doc.setFillColor(255, 255, 255);
        doc.roundedRect(margin, margin + 35, usableWidth, 40, 3, 3, "F");
        doc.setFontSize(18);
        doc.setTextColor(255, 77, 141);
        doc.text("My Savings Goal", pageWidth / 2, margin + 45, {
          align: "center",
        });

        // Add goal details with adjusted spacing
        doc.setFontSize(12);
        doc.setTextColor(80, 80, 80);
        doc.text(messageText, pageWidth / 2, margin + 53, { align: "center" });
        doc.text(progressText, pageWidth / 2, margin + 61, { align: "center" });

        // Get grid data
        const gridCells = document.querySelectorAll(".grid-cell");
        const cellsPerRow = 5; // Reduced from 6 to 5 for better fit
        const totalRows = Math.ceil(gridCells.length / cellsPerRow);

        // Calculate cell dimensions
        const cellWidth = (usableWidth - (cellsPerRow - 1) * 3) / cellsPerRow;
        const cellHeight = 12;
        const startX = margin;
        let startY = margin + 85;
        const padding = 3;
        const maxRowsPerPage = 15;
        let currentPage = 1;

        // Function to add page header
        function addPageHeader(pageNum) {
          if (pageNum > 1) {
            doc.addPage();
            // Add background
            doc.setFillColor(255, 245, 247);
            doc.rect(0, 0, pageWidth, pageHeight, "F");
            startY = margin + 20;
          }

          // Add grid section title
          doc.setFillColor(255, 77, 141);
          doc.setTextColor(255, 255, 255);
          doc.roundedRect(margin, startY - 15, usableWidth, 12, 3, 3, "F");
          doc.setFontSize(12);
          doc.text(`Daily Savings Grid`, pageWidth / 2, startY - 6, {
            align: "center",
          });
        }

        // Add initial page header
        addPageHeader(1);

        // Draw grid cells
        gridCells.forEach((cell, index) => {
          const currentRow = Math.floor(index / cellsPerRow);
          const col = index % cellsPerRow;

          // Check if we need a new page
          if (currentRow > 0 && currentRow % maxRowsPerPage === 0) {
            currentPage++;
            addPageHeader(currentPage);
          }

          // Calculate position
          const adjustedRow = currentRow % maxRowsPerPage;
          const x = startX + col * (cellWidth + padding);
          const y = startY + adjustedRow * (cellHeight + padding);

          // Add cell background
          if (cell.classList.contains("saved")) {
            doc.setFillColor(255, 77, 141);
          } else {
            doc.setFillColor(255, 255, 255);
          }
          doc.roundedRect(x, y, cellWidth, cellHeight, 2, 2, "F");

          // Add cell border
          doc.setDrawColor(255, 77, 141);
          doc.roundedRect(x, y, cellWidth, cellHeight, 2, 2, "D");

          // Add cell text
          doc.setFontSize(9);
          if (cell.classList.contains("saved")) {
            doc.setTextColor(255, 255, 255);
            // Center the checkmark and amount in saved cells
            doc.text(cell.textContent, x + cellWidth / 2, y + cellHeight / 2, {
              align: "center",
            });
          } else {
            doc.setTextColor(80, 80, 80);
            doc.text(cell.textContent, x + cellWidth / 2, y + cellHeight / 2, {
              align: "center",
            });
          }

          // Add day number
          doc.setFontSize(7);
          doc.setTextColor(150, 150, 150);
          doc.text(`Day ${index + 1}`, x + cellWidth / 2, y + cellHeight - 2, {
            align: "center",
          });
        });

        // Add progress tracking section on the last page
        const lastY =
          startY +
          Math.min(
            maxRowsPerPage,
            totalRows - (currentPage - 1) * maxRowsPerPage
          ) *
            (cellHeight + padding) +
          10;

        // Add progress tracking box
        doc.setFillColor(255, 255, 255);
        doc.roundedRect(margin, lastY, usableWidth, 35, 3, 3, "F");

        // Add progress tracking title
        doc.setFontSize(12);
        doc.setTextColor(255, 77, 141);
        doc.text("Progress Tracking", pageWidth / 2, lastY + 12, {
          align: "center",
        });

        // Add date fields
        doc.setFontSize(10);
        doc.setTextColor(80, 80, 80);
        doc.text("Start Date: _____________", margin + 30, lastY + 25);
        doc.text(
          "Target End Date: _____________",
          margin + usableWidth - 30,
          lastY + 25,
          { align: "right" }
        );

        // Add motivational message
        const messageY = lastY + 45;
        doc.setFillColor(255, 209, 220);
        doc.roundedRect(margin, messageY, usableWidth, 20, 3, 3, "F");
        doc.setTextColor(255, 77, 141);
        doc.setFontSize(10);
        doc.text(
          "You're on your way to achieving your savings goal!",
          pageWidth / 2,
          messageY + 8,
          { align: "center" }
        );
        doc.text("Keep up the great work! ðŸ’ª", pageWidth / 2, messageY + 15, {
          align: "center",
        });

        // Add footer
        doc.setTextColor(150, 150, 150);
        doc.setFontSize(8);
        doc.text(
          "Generated by Savings Tracker - Your Path to Financial Success",
          pageWidth / 2,
          pageHeight - 15,
          { align: "center" }
        );
        doc.text(
          new Date().toLocaleDateString(),
          pageWidth / 2,
          pageHeight - 10,
          { align: "center" }
        );

        // Save the PDF
        doc.save("my-savings-plan.pdf");
      }

      function saveProgress() {
        const savedData = {
          savingGoal: document.getElementById("savingGoal").value,
          savedCells: [],
          gridValues: [], // Store the actual grid values
        };

        const gridCells = document.querySelectorAll(".grid-cell");
        gridCells.forEach((cell, index) => {
          savedData.gridValues.push(cell.innerText);
          if (cell.classList.contains("saved")) {
            savedData.savedCells.push(index);
          }
        });

        localStorage.setItem(
          "savingsTrackerProgress",
          JSON.stringify(savedData)
        );
        updateProgressBar();
      }

      function loadProgress() {
        const savedData = localStorage.getItem("savingsTrackerProgress");
        if (savedData) {
          applyLoadedProgress(JSON.parse(savedData));
        }
      }

      function applyLoadedProgress(savedData) {
        if (!savedData) return;

        // Restore form values
        document.getElementById("savingGoal").value = savedData.savingGoal;

        // Recreate grid with saved values
        const container = document.getElementById("grid");
        container.innerHTML = "";

        savedData.gridValues.forEach((value, index) => {
          let div = document.createElement("div");
          div.innerText = value;
          div.className = "grid-cell";
          if (savedData.savedCells.includes(index)) {
            div.classList.add("saved");
          }
          div.onclick = function () {
            this.classList.toggle("saved");
            updateProgressBar();
            saveProgress();
          };
          container.appendChild(div);
        });

        updateProgressBar();
      }

      function copyShareLink() {
        let url = window.location.href;
        navigator.clipboard
          .writeText(url)
          .then(() => {
            alert("Link copied to clipboard!");
          })
          .catch((err) => {
            console.error("Failed to copy link:", err);
          });
      }

      function showColorPreview(color) {
        const preview = document.getElementById("colorPreview");
        const previewBox = document.getElementById("colorPreviewBox");
        const previewText = document.getElementById("colorPreviewText");

        previewBox.style.backgroundColor = color;
        previewText.textContent = `Selected: ${color}`;
        preview.style.display = "flex";

        // Hide preview after 2 seconds
        setTimeout(() => {
          preview.style.display = "none";
        }, 2000);
      }

      // Add tooltips for grid cells
      function updateGridCellTooltips() {
        const cells = document.querySelectorAll(".grid-cell");
        cells.forEach((cell) => {
          const amount = cell.textContent;
          cell.setAttribute("data-tooltip", `Click to mark ${amount} as saved`);
          if (cell.classList.contains("saved")) {
            cell.setAttribute("data-tooltip", `Click to unmark ${amount}`);
          }
        });
      }

      function selectShape(shape) {
        currentShape = shape;

        // Update active state of shape buttons
        document.querySelectorAll(".shape-btn").forEach((btn) => {
          btn.classList.toggle(
            "active",
            btn.getAttribute("data-shape") === shape
          );
        });

        // Update all grid cells with new shape
        const gridCells = document.querySelectorAll(".grid-cell");
        gridCells.forEach((cell) => {
          // Remove all shape classes
          cell.classList.remove(
            "square",
            "circle",
            "envelope",
            "star",
            "heart"
          );
          // Add new shape class
          cell.classList.add(shape);
        });

        // Save shape preference
        localStorage.setItem("savedShape", shape);
      }

      // Add event listener for page load
      document.addEventListener("DOMContentLoaded", function () {
        loadProgress();
        initSpeechRecognition();
        loadSavedColors();
        switchColorType("unsaved");

        // Load saved shape preference
        const savedShape = localStorage.getItem("savedShape");
        if (savedShape) {
          selectShape(savedShape);
        }
      });
    </script>
  </body>
</html>
